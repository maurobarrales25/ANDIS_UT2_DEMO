import requests
from jose import jwt

# 1. Access token que te dio Keycloak
token = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIyU28wY0xrZXNFNWlBYXFibUFVbXdzbVQ2VUo4UXFQQ0cyRXVlNkpVandBIn0.eyJleHAiOjE3NTc4Nzc2MjYsImlhdCI6MTc1Nzg3NzMyNiwianRpIjoib25ydHJvOjE3ODNiOGU4LTRkZWMtMTE4Yi0wNzNlLTFlNGMwNTgwZTg4NyIsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9yZWFsbXMvZGVtby1yZWFsbSIsImF1ZCI6ImFjY291bnQiLCJzdWIiOiI0ZjllY2E2MS0zZGM1LTQxNmMtOWM0ZC00MDcwY2RhN2RiMWEiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJkZW1vLWNsaWVudCIsInNpZCI6Ijc1MWJhZWRiLTRjODctNGVmOC1iOTJlLWQyMWEwNDY0M2UwNCIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cDovLzEyNy4wLjAuMTo4MDAyLyoiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiZGVmYXVsdC1yb2xlcy1kZW1vLXJlYWxtIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6ImVtYWlsIHByb2ZpbGUiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlRlc3QgQWd1cyIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R1c2VyIiwiZ2l2ZW5fbmFtZSI6IlRlc3QiLCJmYW1pbHlfbmFtZSI6IkFndXMiLCJlbWFpbCI6ImFndXN0aW5hYWdnMDdAZ21haWwuY29tIn0.C0nzfHUJV4X1v2yFDx9PT0g_g-huhEfCwW1yaPtqN3-au9mmZPBGda4Jg5oiQTfEBWrAq0Tunf8y7Z2JVdl0JXDKIGYQWz9ykfMLqfMQWe868bgqiCjfjAtTVVXCCjAAM13nls1D4YFHsmltqSccFa0ohPJ3cUMCCGiaFZCgjFtMxfmjk0B4y5ZAWdrXKV117XzItrjPa7iAyk75MACR8nvr40v79fFZI1HFDkmvubOlnJUD7FkZe4XoLap48qzEwwx89ISHuLmRPTz_yDm4zMTQEifIKorJzRi80Te5Bf3UWzcdliAr4Afova3hph1lmo-VuWLNSwHyCuPT8s7x1g"

# 2. Pedimos JWKS (llaves públicas del realm)
jwks_url = "http://localhost:8080/realms/demo-realm/protocol/openid-connect/certs"
jwks = requests.get(jwks_url).json()

# 3. Decodificamos con las llaves públicas
payload = jwt.decode(
    token,
    jwks,
    algorithms=["RS256"],
    audience="account",  # o tu client_id
    issuer="http://localhost:8080/realms/demo-realm"
)

print("Payload:", payload)
